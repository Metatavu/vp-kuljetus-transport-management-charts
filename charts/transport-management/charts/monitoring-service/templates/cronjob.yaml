apiVersion: batch/v1
kind: CronJob
metadata:
  name: monitoringservice-cronjob
spec:
  schedule: "* * * * *"
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: resolvemonitorstatuses
            image: busybox:1.34.1
            imagePullPolicy: IfNotPresent
            envFrom:
              - secretRef:
                  name: {{ .Values.monitoringServiceSecretName }}
            command:
              - "sh"
              - "-c"
              - |          
                  wget -qO- --header "X-CRON-API-KEY: $(VP_MONITORING_CRON_APIKEY)" "http://{{ .Release.Name }}-monitoring-service.{{ .Release.Namespace }}.svc.cluster.local:8080/v1/cron/resolvemonitorstatuses"
          restartPolicy: Never
